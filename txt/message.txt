<?php  // Incluimos el archivo de conexión a la base de datos include("connection.php");  // Verificamos si la solicitud es un POST y si los campos necesarios están presentes if ($_SERVER["REQUEST_METHOD"] == "POST" && isset($_POST["nombres"]) && isset($_POST["nombre_categoria"]) && isset($_POST["titulo"])) {     $nombres = htmlspecialchars($_POST["nombres"]);     $nacionalidad = htmlspecialchars($_POST["nacionalidad"]);     $fecha_nacimiento = htmlspecialchars($_POST["fecha_nacimiento"]);      $nombre_categoria = htmlspecialchars($_POST["nombre_categoria"]);      $titulo = htmlspecialchars($_POST["titulo"]);     $editorial = htmlspecialchars($_POST["editorial"]);     $cantidad_disponible = htmlspecialchars($_POST["cantidad_disponible"]);     $isbn = htmlspecialchars($_POST["isbn"]);     $anio_publicacion = htmlspecialchars($_POST["año_publicacion"]);     $cantidad_total = htmlspecialchars($_POST["cantidad_total"]);      try {                  $conn->beginTransaction();          // 1. Inserción del autor         // Preparamos la consulta SQL para evitar inyección SQL         $sql_autor = "INSERT INTO autores (nombres, nacionalidad, fecha_nacimiento) VALUES (?, ?, ?)";         $stmt_autor = $conn->prepare($sql_autor);         $stmt_autor->execute([$nombres, $nacionalidad, $fecha_nacimiento]);         $autor_id = $conn->lastInsertId();                    $sql_categoria = "INSERT INTO categorias (nombre_categoria) VALUES (?)";         $stmt_categoria = $conn->prepare($sql_categoria);         $stmt_categoria->execute([$nombre_categoria]);         $categoria_id = $conn->lastInsertId();         $sql_libro = "INSERT INTO libros (titulo, autor_id, editorial, categoria_id, cantidad_disponible, isbn, anio_publicacion, cantidad_total) VALUES (?, ?, ?, ?, ?, ?, ?, ?)";         $stmt_libro = $conn->prepare($sql_libro);         $stmt_libro->execute([$titulo, $autor_id, $editorial, $categoria_id, $cantidad_disponible, $isbn, $anio_publicacion, $cantidad_total]);                   $conn->commit();         echo "<h1>¡Datos cargados correctamente!</h1>";      } catch(PDOException $e) {         // Si algo falla, revertimos todos los cambios         $conn->rollBack();         echo "<h1>Error al cargar los datos:</h1><p>" . $e->getMessage() . "</p>";     } }  ?>  <html> <head>     <title>Cargar Datos de Libros</title> </head> <body>  <form action="loadingdata.php" method="post">     <h2>Cargar Autor</h2>     <label for="nombres">Nombre del Autor:</label>     <input type="text" id="nombres" name="nombres" required>     <br><br>     <label for="nacionalidad">Nacionalidad:</label>     <input type="text" id="nacionalidad" name="nacionalidad" required>     <br><br>     <label for="fecha_nacimiento">Fecha de Nacimiento:</label>     <input type="date" id="fecha_nacimiento" name="fecha_nacimiento" required>     <br><br>      <h2>Cargar Categoría</h2>     <label for="nombre_categoria">Nombre de la Categoría:</label>     <input type="text" id="nombre_categoria" name="nombre_categoria" required>     <br><br>      <h2>Cargar Libro</h2>     <label for="titulo">Título:</label>     <input type="text" id="titulo" name="titulo" required>     <br><br>     <label for="editorial">Editorial:</label>     <input type="text" id="editorial" name="editorial" required>     <br><br>     <label for="cantidad_disponible">Cantidad Disponible:</label>     <input type="number" id="cantidad_disponible" name="cantidad_disponible" required>     <br><br>     <label for="isbn">ISBN:</label>     <input type="text" id="isbn" name="isbn" required>     <br><br>     <label for="año_publicacion">Año de Publicación:</label>     <input type="number" id="año_publicacion" name="año_publicacion" required>     <br><br>     <label for="cantidad_total">Cantidad Total:</label>     <input type="number" id="cantidad_total" name="cantidad_total" required>     <br><br>      <input type="submit" value="Cargar Datos"> </form>  </body> </html>